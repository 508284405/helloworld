# 使用自定义镜像 my-apisix:local（基于 apisix.Dockerfile 构建），以 Standalone 模式在集群内运行。
# - Service/gateway: NodePort 暴露 30080 -> 9080，便于本机直接访问。
# - Service/admin: 仅 ClusterIP 暴露 9180（开发用途，不建议对外开放）。

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: apisix-standalone
  namespace: apisix
labels:
  app: apisix
spec:
  replicas: 1
  selector:
    matchLabels:
      app: apisix
  template:
    metadata:
      labels:
        app: apisix
    spec:
      containers:
        - name: apisix
          image: my-apisix:local        # 与本地构建的镜像标签一致
          imagePullPolicy: IfNotPresent
          ports:
            - name: http
              containerPort: 9080      # 网关 HTTP
            - name: https
              containerPort: 9443      # 网关 HTTPS
            - name: admin
              containerPort: 9180      # Admin API（仅开发调试）

---
apiVersion: v1
kind: Service
metadata:
  name: apisix-gateway
  namespace: apisix
labels:
  app: apisix
spec:
  type: NodePort
  selector:
    app: apisix
  ports:
    - name: http
      port: 9080
      targetPort: 9080
      nodePort: 30080       # 节点对外端口（开发友好）。Docker Desktop 可直接 http://localhost:30080
    - name: https
      port: 9443
      targetPort: 9443

---
apiVersion: v1
kind: Service
metadata:
  name: apisix-admin
  namespace: apisix
labels:
  app: apisix
spec:
  type: ClusterIP
  selector:
    app: apisix
  ports:
    - name: admin
      port: 9180
      targetPort: 9180

